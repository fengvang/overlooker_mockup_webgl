<!DOCTYPE html>
<html lang="">

<head>
  <title>Overlooker</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <meta charset="utf-8">
  <script src="libraries/twgl-full.min.js"></script>
</head>

<body>
  <canvas id="cgl">
    <script id="vertex_texture" type="notjs">
    precision highp float;
    
    attribute vec2 a_position;
    attribute vec2 a_texcoord;
    
    uniform mat3 u_matrix;
    varying vec2 v_texcoord;
      
    void main() {
      gl_Position = vec4(a_position, 1.0, 1.0);
      v_texcoord = 0.5 * a_position.xy + 0.5;
    }
          </script>
    <script id="vertex_screen" type="notjs">
  precision highp float;

  attribute vec2 a_position;
  attribute vec2 a_texcoord;

  uniform mat3 u_matrix;
  varying vec2 v_texcoord;
  
  void main() {
     gl_Position = vec4(u_matrix * vec3(a_position, 1.0), 1.0);
     v_texcoord = 0.5 * a_position.xy + 0.5;
  }
      </script>
    <script id="fragment_texture" type="notjs">
  precision highp float;

  uniform vec2 u_resolution;
  uniform vec2 u_mouse;
  uniform float u_time;
  uniform float u_interval;
  uniform vec3 u_gridparams;
  uniform vec3 u_colortheme[6];
  uniform sampler2D u_texture_data;

  varying vec2 v_texcoord;

  vec4 colorCheck(in float _code) {
    vec4 _color = vec4(0.0);
    if (_code == 0.0) {         
      if (u_colortheme[0].r + u_colortheme[0].g + u_colortheme[0].b < 1.5) {
        _color = vec4(u_colortheme[0].rgb + vec3(0.15), 1.0);
      } else {
        _color = vec4(u_colortheme[0].rgb - vec3(0.15), 1.0);
      }                         // neverInitialized
      _color.xyz = clamp(_color.rgb, 0.0, 1.0); 
    } else if (_code <= 0.2) {
      _color.xyz = u_colortheme[1]; // Available
    } else if (_code <= 0.4) {
      _color.xyz = u_colortheme[2]; // PreviewingTask
    } else if (_code <= 0.6) {
      _color.xyz = u_colortheme[3]; // OnCall
    } else if (_code <= 0.8) {
      _color.xyz = u_colortheme[4]; // AfterCall
    } else {
      _color.xyz = u_colortheme[5]; // LoggedOut
    }
    _color.w = 1.0;
    return _color;
  }

  float mapTime (float start, float end, float time) {
    return clamp((time - start) / (end - start), 0.0, 1.0);
  }

  void main() {
    vec4 tex_color = texture2D(u_texture_data, v_texcoord);
    vec4 start_color = colorCheck(tex_color.x);
    vec4 end_color = colorCheck(tex_color.y);
    vec4 shaded = vec4(0.0);

    float timer_dot = u_time;
    float timestamp = 255.0 * tex_color.w;

    float start = 0.0;
    float end = 0.0;
    float mix_amount = 0.0;

    // Animation looping logic:
    //
    // If the timer is chasing behind the timestamp and won't loop before catching it,
    // then the startpoint is simply the timestamp - the length of the animation interval.
    if (timer_dot <= 255.0 - u_interval + timestamp) {      
      start = timestamp - u_interval;
      end = timestamp;
    // If the timer is going to loop then project the endpoint beyond the right side of the
    // timer number line.   
    } else {
      start = 255.0 - (u_interval - timestamp);
      end = 255.0 + timestamp;
    }
    mix_amount = mapTime(start, end, timer_dot);
    shaded = vec4(mix(start_color.rgb, end_color.rgb, mix_amount), 1.0);
    
    gl_FragColor = shaded;
  }

  </script>
    <script id="fragment_screen" type="notjs">
  precision highp float;
  
  uniform vec2 u_resolution;
  uniform vec2 u_mouse;
  uniform float u_time;
  uniform float u_interval;
  uniform vec3 u_gridparams;
  uniform vec3 u_colortheme[6];
  uniform sampler2D u_texture_color;
  
  varying vec2 v_texcoord;

  float aa_factor = u_gridparams.y * 1.5 / u_resolution.y;
  float radius = u_gridparams.z / 2.0;

  // Dot product approach to drawing a circle:
  float circle_dot(in vec2 _uv) {
    vec2 centered = _uv.xy * vec2(2.0) - vec2(1.0);
    float d = 0.5 * dot(centered, centered) + radius;
    return smoothstep(0.5 + aa_factor, 0.5 - aa_factor, d);
  }

  void main() {
    vec4 tex_color = texture2D(u_texture_color, v_texcoord);
    vec2 uv = v_texcoord.xy;
    uv.xy = fract(uv.xy * u_gridparams.xy);

    gl_FragColor = vec4(mix(u_colortheme[0].rgb, tex_color.rgb, circle_dot(uv)), 1.0);
  }
 
      </script>
  </canvas>
</body>
<script src="call_center_mockup.js"></script>
</html>
